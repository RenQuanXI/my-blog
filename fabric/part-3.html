<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第三部分</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/ibook/assets/css/0.styles.97c30387.css" as="style"><link rel="preload" href="/ibook/assets/js/app.f3dfeeca.js" as="script"><link rel="preload" href="/ibook/assets/js/2.a89a11ce.js" as="script"><link rel="preload" href="/ibook/assets/js/19.d1dc4ccb.js" as="script"><link rel="prefetch" href="/ibook/assets/js/10.af12a82d.js"><link rel="prefetch" href="/ibook/assets/js/11.6cc43d9b.js"><link rel="prefetch" href="/ibook/assets/js/12.c1c3dc10.js"><link rel="prefetch" href="/ibook/assets/js/13.dca409ac.js"><link rel="prefetch" href="/ibook/assets/js/14.4d879880.js"><link rel="prefetch" href="/ibook/assets/js/15.85aa52f1.js"><link rel="prefetch" href="/ibook/assets/js/16.0c26d41c.js"><link rel="prefetch" href="/ibook/assets/js/17.36356e53.js"><link rel="prefetch" href="/ibook/assets/js/18.24a4eb8e.js"><link rel="prefetch" href="/ibook/assets/js/20.10200094.js"><link rel="prefetch" href="/ibook/assets/js/21.3bb51aa7.js"><link rel="prefetch" href="/ibook/assets/js/22.c7c5a85d.js"><link rel="prefetch" href="/ibook/assets/js/23.72040ccb.js"><link rel="prefetch" href="/ibook/assets/js/24.c4b914ae.js"><link rel="prefetch" href="/ibook/assets/js/25.161a7752.js"><link rel="prefetch" href="/ibook/assets/js/26.fa65ff0a.js"><link rel="prefetch" href="/ibook/assets/js/27.37286a9b.js"><link rel="prefetch" href="/ibook/assets/js/28.7843ccc5.js"><link rel="prefetch" href="/ibook/assets/js/29.f1d9dec2.js"><link rel="prefetch" href="/ibook/assets/js/3.fb47020c.js"><link rel="prefetch" href="/ibook/assets/js/30.7cef5e20.js"><link rel="prefetch" href="/ibook/assets/js/31.876b1486.js"><link rel="prefetch" href="/ibook/assets/js/32.250a8170.js"><link rel="prefetch" href="/ibook/assets/js/33.04cc6c24.js"><link rel="prefetch" href="/ibook/assets/js/34.a11a10f8.js"><link rel="prefetch" href="/ibook/assets/js/35.40fa11c8.js"><link rel="prefetch" href="/ibook/assets/js/36.bfeb614f.js"><link rel="prefetch" href="/ibook/assets/js/37.cdd7760e.js"><link rel="prefetch" href="/ibook/assets/js/38.c7aee897.js"><link rel="prefetch" href="/ibook/assets/js/39.3b49dfa4.js"><link rel="prefetch" href="/ibook/assets/js/4.eb34ec45.js"><link rel="prefetch" href="/ibook/assets/js/40.62e8e526.js"><link rel="prefetch" href="/ibook/assets/js/41.50410ec0.js"><link rel="prefetch" href="/ibook/assets/js/42.1b86548f.js"><link rel="prefetch" href="/ibook/assets/js/43.2ae6caa2.js"><link rel="prefetch" href="/ibook/assets/js/44.75f7a0a7.js"><link rel="prefetch" href="/ibook/assets/js/5.fc1e6d38.js"><link rel="prefetch" href="/ibook/assets/js/6.1f874886.js"><link rel="prefetch" href="/ibook/assets/js/7.f700d755.js"><link rel="prefetch" href="/ibook/assets/js/8.ecde6251.js"><link rel="prefetch" href="/ibook/assets/js/9.864b0981.js">
    <link rel="stylesheet" href="/ibook/assets/css/0.styles.97c30387.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><main><main slot="sidebar-top"><a href="https://github.com/renquanxi" aria-label="View source on GitHub" target="_blank" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path> <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm" style="transform-origin: 130px 106px;"></path> <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></main> <div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ibook/" class="home-link router-link-active"><img src="/ibook/image/logo_smile.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ibook/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/studyNote/JS语法基础.html" class="nav-link">
  JS语法基础
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/JS进阶语法.html" class="nav-link">
  JS进阶语法
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/webAPI.html" class="nav-link">
  webAPI
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/jQuery常用语法.html" class="nav-link">
  jQuery常用语法
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/ES6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/Ajax 笔记整理.html" class="nav-link">
  Ajax 笔记整理
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/git学习.html" class="nav-link">
  git学习
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/常用数组方法整理.html" class="nav-link">
  常用数组方法整理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/fabric/" class="nav-link router-link-active">
  fabric中文文档
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题" class="dropdown-title"><span class="title">问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="问题" class="mobile-dropdown-title"><span class="title">问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/question/" class="nav-link">
  常见问题
</a></li><li class="dropdown-item"><!----> <a href="/ibook/createblog/" class="nav-link">
  vuepress相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><span class="title">收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="收藏" class="mobile-dropdown-title"><span class="title">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/collect/01.网站/" class="nav-link">
  网站
</a></li><li class="dropdown-item"><!----> <a href="/ibook/collect/02.资源/" class="nav-link">
  资源
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/renquanxi/ibook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  查看源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ibook/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/studyNote/JS语法基础.html" class="nav-link">
  JS语法基础
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/JS进阶语法.html" class="nav-link">
  JS进阶语法
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/webAPI.html" class="nav-link">
  webAPI
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/jQuery常用语法.html" class="nav-link">
  jQuery常用语法
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/ES6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/Ajax 笔记整理.html" class="nav-link">
  Ajax 笔记整理
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/git学习.html" class="nav-link">
  git学习
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/常用数组方法整理.html" class="nav-link">
  常用数组方法整理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/fabric/" class="nav-link router-link-active">
  fabric中文文档
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题" class="dropdown-title"><span class="title">问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="问题" class="mobile-dropdown-title"><span class="title">问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/question/" class="nav-link">
  常见问题
</a></li><li class="dropdown-item"><!----> <a href="/ibook/createblog/" class="nav-link">
  vuepress相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><span class="title">收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="收藏" class="mobile-dropdown-title"><span class="title">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/collect/01.网站/" class="nav-link">
  网站
</a></li><li class="dropdown-item"><!----> <a href="/ibook/collect/02.资源/" class="nav-link">
  资源
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/renquanxi/ibook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  查看源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/ibook/fabric/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/ibook/fabric/part-1.html" class="sidebar-link">第一部分</a></li><li><a href="/ibook/fabric/part-2.html" class="sidebar-link">第二部分</a></li><li><a href="/ibook/fabric/part-3.html" aria-current="page" class="active sidebar-link">第三部分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ibook/fabric/part-3.html#组合-group" class="sidebar-link">组合（Group）</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-3.html#序列化" class="sidebar-link">序列化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ibook/fabric/part-3.html#toobject-tojson" class="sidebar-link">toObject, toJSON</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-3.html#tosvg" class="sidebar-link">toSVG</a></li></ul></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-3.html#反序列化-svg解析器" class="sidebar-link">反序列化，SVG解析器</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-3.html#子类" class="sidebar-link">子类</a></li></ul></li><li><a href="/ibook/fabric/part-4.html" class="sidebar-link">第四部分</a></li><li><a href="/ibook/fabric/part-5.html" class="sidebar-link">第五部分</a></li><li><a href="/ibook/fabric/part-6.html" class="sidebar-link">第六部分</a></li><li><a href="/ibook/fabric/part-7.html" class="sidebar-link">第七部分</a></li><li><a href="/ibook/fabric/part-8.html" class="sidebar-link">第八部分</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第三部分"><a href="#第三部分" class="header-anchor">#</a> 第三部分</h1> <p>我们已经介绍了本系列的第一部分和第二部分的大部分基础知识。我们继续前进到更高级的技巧！</p> <h2 id="组合-group"><a href="#组合-group" class="header-anchor">#</a> 组合（Group）</h2> <p><img src="http://fabricjs.com/article_assets/8.png" alt=" "></p> <p>我们首先谈论的是组合。组合是Fabric最强大的功能之一。 将任何Fabric对象分组成一个单一实体的简单方法，为什么要这样做？当然是为了能够将这些对象作为一个单元来处理。</p> <p>可以用鼠标来将画布上的任何数量的Fabric对象进行分组，形成单一的组合形式，一旦分组，组内Fabric对象可以一起移动，甚至一起修改。他们组成一个组。我们可以缩放这个组合，旋转，甚至改变其表现性质：颜色、透明度、边界等。</p> <p>这正是组合所要做的，每当您在画布上看到这样的选择时，Fabric将在内部创建一组对象。只有以编程方式提供使用组的访问才有意义。这就是是fabric的组合。</p> <p>让我们创建一个包含两个Fabric对象的组合，圆和文本：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> circle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  radius<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'#eef'</span><span class="token punctuation">,</span>
  scaleY<span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
  originX<span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
  originY<span class="token operator">:</span> <span class="token string">'center'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  fontSize<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
  originX<span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
  originY<span class="token operator">:</span> <span class="token string">'center'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">[</span> circle<span class="token punctuation">,</span> text <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  left<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  angle<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>首先，我们创建了一个“hello world”文本对象。将<code>originX</code>和<code>originY</code>设置为“center”会使得将以组合为中心，默认情况下，组合成员相对于组合的左上角定位。然后，圆圈以100px半径填充“#eef”颜色并垂直缩放0.5倍（scaleY = 0.5）。然后，我们创建了一个<code>fabric.Group</code>实例，通过一个包含这两个Fabric对象的数组传递给这个组合，并给它的位置为150/100和-10角度。最后，将这个组合添加到画布（使用<code>canvas.add（）</code>）。</p> <p>您会看到画布上的一个对象，看起来像一个椭圆标签。请注意，如果我们要修改他们的样子，可以将该他们作为单个实体使用，我们只是改变组合的属性，给出要更改的的<code>left</code>，<code>top</code>和<code>angle</code>值。</p> <p><img src="http://fabricjs.com/article_assets/3_1.png" alt=" "></p> <p>让我们再来修改一下canvas画布上的这个组合：</p> <div class="language-js extra-class"><pre class="language-js"><code>group<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFill</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
group<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  text<span class="token operator">:</span> <span class="token string">'trololo'</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'white'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里发生了什么？我们通过<code>item（）</code>方法访问组中的各个对象，并修改其属性。第一个对象是椭圆，第二个是文字。让我们看看发生了什么：</p> <p><img src="http://fabricjs.com/article_assets/3_2.png" alt=" "></p> <p>您现在可能注意到的一件重要的事情是，组合中的对象都相对于组合的中心定位，当我们改变了text对象中的内容时，即使内容的宽度改变了，但是它仍然保持居中的位置，如果你不想要这个行为，您需要指定对象的left/right坐标。在这种情况下，根据这些坐标将它们分组在一起。</p> <p>让我们创建并组合3个圆，使它们相互水平定位：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> circle1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  radius<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
  left<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> circle2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  radius<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'green'</span><span class="token punctuation">,</span>
  left<span class="token operator">:</span> <span class="token number">100</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> circle3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  radius<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span>
  left<span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">[</span> circle1<span class="token punctuation">,</span> circle2<span class="token punctuation">,</span> circle3 <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  left<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> <span class="token number">100</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/3_3.png" alt=" "></p> <p>使用团体时要注意的另一件事是<strong>对象的状态</strong>，举个例子，当使用图片形成组合时，您需要确保这些图像已经完全加载。由于Fabric已经提供了帮助方法来确保图像被加载，这变得相当容易：</p> <div class="language-js extra-class"><pre class="language-js"><code>fabric<span class="token punctuation">.</span>Image<span class="token punctuation">.</span><span class="token function">fromURL</span><span class="token punctuation">(</span><span class="token string">'/assets/pug.jpg'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> img1 <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> left<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  fabric<span class="token punctuation">.</span>Image<span class="token punctuation">.</span><span class="token function">fromURL</span><span class="token punctuation">(</span><span class="token string">'/assets/pug.jpg'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> img2 <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> left<span class="token operator">:</span> <span class="token number">175</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">175</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fabric<span class="token punctuation">.</span>Image<span class="token punctuation">.</span><span class="token function">fromURL</span><span class="token punctuation">(</span><span class="token string">'/assets/pug.jpg'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> img3 <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> left<span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">250</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">[</span> img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> img3<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> left<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/3_4.png" alt=" "></p> <p>在使用组合时可以使用哪些其他方法?使用<code>getObjects（）</code>方法，可以返回一个包含组合中所有对象的数组，使用<code>size（）</code>可以知道组合中所有对象的数量。使用<code>contains（）</code>可以检查某个对象是否在组合中。我们之前看到的<code>item（）</code>可以检索组中的特定对象。使用<code>forEachObject</code>可以遍历每个组合中的对象。还有<code>add（）</code>和<code>remove（）</code>方法来相应地从组中添加和删除对象。</p> <p>您可以通过2种方式添加/删除组中的对象：更新组合的尺寸/位置，我们建议使用更新尺寸，除非您正在执行批量处理操作，并且在进程中组合的宽度/高度都没有问题。</p> <p>在组合中心添加一个长方形：</p> <div class="language-js extra-class"><pre class="language-js"><code>group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Rect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  originX<span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
  originY<span class="token operator">:</span> <span class="token string">'center'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在组合的中心附近100px添加矩形：</p> <div class="language-js extra-class"><pre class="language-js"><code>group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Rect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  left<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  originX<span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
  originY<span class="token operator">:</span> <span class="token string">'center'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在组合中心添加矩形并且更新组合的尺寸：</p> <div class="language-js extra-class"><pre class="language-js"><code>group<span class="token punctuation">.</span><span class="token function">addWithUpdate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Rect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  left<span class="token operator">:</span> group<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'left'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> group<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'top'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  originX<span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
  originY<span class="token operator">:</span> <span class="token string">'center'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在组合的中心附近100px添加矩形并且更新组合的尺寸：</p> <div class="language-js extra-class"><pre class="language-js"><code>group<span class="token punctuation">.</span><span class="token function">addWithUpdate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Rect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  left<span class="token operator">:</span> group<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'left'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> group<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'top'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">,</span>
  originX<span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
  originY<span class="token operator">:</span> <span class="token string">'center'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>最后，如果您想创建一个已经存在于画布上的对象的组合，则需要首先克隆它们：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建一个包含两个已存在对象的副本的组合</span>
<span class="token keyword">var</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  canvas<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  canvas<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 移除所有对象并且重新渲染</span>
canvas<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">renderAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将组合添加到canvas画布</span>
canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="序列化"><a href="#序列化" class="header-anchor">#</a> 序列化</h2> <p>一旦你开始构建一种有状态的应用程序，也许允许用户在服务器上保存画布内容的结果，或者将内容流传输到不同的客户端，你都需要<strong>canvas序列化</strong>。如果仍然要发送画布内容，也是可以的，有一个选项可以将画布导出到图像。但是上传图片到服务器无疑是相当占用带宽的，论大小，没有什么可以比得过文本了，这就是为什么Fabric为canvas画布序列化/反序列化提供了极好的支持。</p> <h3 id="toobject-tojson"><a href="#toobject-tojson" class="header-anchor">#</a> toObject, toJSON</h3> <p>Fabric中的canvas序列化方法主要是<code>toObject（）</code>和<code>toJSON（）</code>方法。我们来看一个简单的例子，首先序列化一个空的画布：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Canvas</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// '{&quot;objects&quot;:[],&quot;background&quot;:&quot;rgba(0, 0, 0, 0)&quot;}'</span>
</code></pre></div><p>我们使用ES5 <code>JSON.stringify（）</code>方法，如果<code>toJSON</code>方法存在，则会隐性调用。由于Fabric中的canvas实例已经具有<code>toJSON</code>方法，就相当于我们调用了<code>canvas.toJSON（）</code>。</p> <p>注意返回的表示空的canvas画布的字符串。它是JSON形式，并且由“objects”和“background”属性组成。“objects”当前为空，因为canvas上没有任何内容，而background的默认值为“rgba（0，0，0，0）”）。</p> <p>让我们给画布不同的背景，看看它有什么变化：</p> <div class="language-js extra-class"><pre class="language-js"><code>canvas<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// '{&quot;objects&quot;:[],&quot;background&quot;:&quot;red&quot;}'</span>
</code></pre></div><p>正如所料，画布表现现在反映出新的背景颜色。现在，我们来添加一些Fabric对象！</p> <div class="language-js extra-class"><pre class="language-js"><code>canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Rect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  left<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  width<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'green'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出是：</p> <div class="language- extra-class"><pre class="language-text"><code>'{&quot;objects&quot;:[{&quot;type&quot;:&quot;rect&quot;,&quot;left&quot;:50,&quot;top&quot;:50,&quot;width&quot;:20,&quot;height&quot;:20,&quot;fill&quot;:&quot;green&quot;,&quot;overlayFill&quot;:null,&quot;stroke&quot;:null,&quot;strokeWidth&quot;:1,&quot;strokeDashArray&quot;:null,&quot;scaleX&quot;:1,&quot;scaleY&quot;:1,&quot;angle&quot;:0,&quot;flipX&quot;:false,&quot;flipY&quot;:false,&quot;opacity&quot;:1,&quot;selectable&quot;:true,&quot;hasControls&quot;:true,&quot;hasBorders&quot;:true,&quot;hasRotatingPoint&quot;:false,&quot;transparentCorners&quot;:true,&quot;perPixelTargetFind&quot;:false,&quot;rx&quot;:0,&quot;ry&quot;:0}],&quot;background&quot;:&quot;rgba(0, 0, 0, 0)&quot;}'
</code></pre></div><p>看起来改变了好多，在“objects”数组新增了一个对象，序列化为JSON。请注意它的表示方式是如何包含其所有视觉特征：left, top, width, height, fill, stroke等。</p> <p>如果我们要添加另一个对象，比如，一个位于矩形旁边的红色圆圈，您会看到相应改变：</p> <div class="language-js extra-class"><pre class="language-js"><code>canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  left<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  radius<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'red'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出是：</p> <div class="language- extra-class"><pre class="language-text"><code>'{&quot;objects&quot;:[{&quot;type&quot;:&quot;rect&quot;,&quot;left&quot;:50,&quot;top&quot;:50,&quot;width&quot;:20,&quot;height&quot;:20,&quot;fill&quot;:&quot;green&quot;,&quot;overlayFill&quot;:null,&quot;stroke&quot;:null,&quot;strokeWidth&quot;:1,&quot;strokeDashArray&quot;:null,&quot;scaleX&quot;:1,&quot;scaleY&quot;:1,&quot;angle&quot;:0,&quot;flipX&quot;:false,&quot;flipY&quot;:false,&quot;opacity&quot;:1,&quot;selectable&quot;:true,&quot;hasControls&quot;:true,&quot;hasBorders&quot;:true,&quot;hasRotatingPoint&quot;:false,&quot;transparentCorners&quot;:true,&quot;perPixelTargetFind&quot;:false,&quot;rx&quot;:0,&quot;ry&quot;:0},{&quot;type&quot;:&quot;circle&quot;,&quot;left&quot;:100,&quot;top&quot;:100,&quot;width&quot;:100,&quot;height&quot;:100,&quot;fill&quot;:&quot;red&quot;,&quot;overlayFill&quot;:null,&quot;stroke&quot;:null,&quot;strokeWidth&quot;:1,&quot;strokeDashArray&quot;:null,&quot;scaleX&quot;:1,&quot;scaleY&quot;:1,&quot;angle&quot;:0,&quot;flipX&quot;:false,&quot;flipY&quot;:false,&quot;opacity&quot;:1,&quot;selectable&quot;:true,&quot;hasControls&quot;:true,&quot;hasBorders&quot;:true,&quot;hasRotatingPoint&quot;:false,&quot;transparentCorners&quot;:true,&quot;perPixelTargetFind&quot;:false,&quot;radius&quot;:50}],&quot;background&quot;:&quot;rgba(0, 0, 0, 0)&quot;}'
</code></pre></div><p>注意看<code>“type”：“rect”</code>和<code>“type”：“circle”</code>部分，即使起初看起来可能会有很多输出，但是与图像序列化所得到的结果无关。只是为了比较，让我们来看看你将用<code>canvas.toDataURL（'png'）</code>获得的一个字符串的大约1/10（！）</p> <div class="language- extra-class"><pre class="language-text"><code>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAK8CAYAAAAXo9vkAAAgAElEQVR4Xu3dP4xtBbnG4WPAQOQ2YBCLK1qpoQE1/m+NVlCDwUACicRCEuysrOwkwcJgAglEItRQaWz9HxEaolSKtxCJ0FwMRIj32zqFcjm8e868s2fNWo/Jygl+e397rWetk5xf5pyZd13wPwIECBAgQIAAAQIECBxI4F0H+hwfQ4AAAQIECBAgQIAAgQsCxENAgAABAgQIECBAgMDBBATIwah9EAECBAgQIECAAAECAsQzQIAAAQIECBAgQIDAwQQEyMGofRABAgQIECBAgAABAgLEM0CAAAECBAgQIECAwMEEBMjBqH0QAQIECBAgQIAAAQICxDNAgAABAgQIECBAgMDBBATIwah9EAECBAgQIECAAAECAsQzQIAAAQIECBAgQIDAwQQEyMGofRABAgQIECBAgAABAgLEM0CAAAECBAgQIECAwMEEBMjBqH0QAQIECBAgQIAAAQICxDNAgAABAgQIECBAgMDBBATIwah9EAECBAgQIECAAAECAsQzQIAAAQIECBAgQIDAwQQEyMGofRABAgQIECBAgAABAgLEM0CAAAECBAgQIECAwMEEBMjBqH0QAQIECBAgQIAAAQICxDNAgAABAgQIECBAgMDBBATIwah9EAECBAgQIECAAAECAsQzQIAAAQIECBAgQIDAwQQEyMGofRABAgQIECBAgAABAgLEM0CAAAECBAgQIECAwMEEBMjBqH0QAQIECBAgQIAAAQICxDNAgAABAgQIECBAgMDBBATIwah9EAECBAgQIECAAAECAsQzQIAAAQIECBAgQIDAwQQEyMGofRABAgQIECBAgAABAgLEM0CAAAECBAgQIECAwMEEBMjBqH0QAQIECBAgQIAAAQICxDNAgAABAgQIECBAgMDBBATIwah9EAECBAgQIECAAAECAsQzQIAAAQIECBAgQIDAwQQEyMGofRABAgQIECBAgAABAgLEM0CAAAECBAgQIECAwMEEBMjBqH0QAQIECBAgQIAAAQICxDNAgAABAgQIECBAgMDBBATIwah9EAECBAgQIECAAAECyw+Qb134R/U2fevC8q+5esGWESBAgAABAgQIEFiOwPL/MC5AlvO0OBMCBAgQIECAAAECJxQQICcE9HYCBAgQIECAAAECBPYXECD7W3klAQIECBAgQIAAAQInFBAgJwT0dgIECBAgQIAAAQIE9hcQIPtbeSUBAgQIECBAgAABAicUECAnBPR2AgQIECBAgAABAgT2FxAg+1t5JQECBAgQIECAAAECJxQQICcE9HYCBAgQIECAAAECBPYXECD7W3klAQIECBAgQIAAAQInFBAgJwTc9+3z49yvmNd+dI7PzPHJOW6Y4wNzXD3HlXNc9pZdb85/vzbHK3P8aY7n5vj1HL+Y43dz417f97O9jgABAgQIECBAgMBSBATIKd2JCY5dWNwyx5fn+PwcV5U/6tXZ99M5fjjHk3Mjd6HifwQIECBAgAABAgQWLSBAirdnouP6WXfvHHfOcU1x9T6rXp4XPTLHA3NTX9jnDV5DgAABAgQIECBA4NACAuSE4hMdl8+Kr83xzTmuO+G61ttfnEXfnuN7c4PfaC21hwABAgQIECBAgMBJBQTIJQpOeFw7b71/jtsvccWh3vbYfNB9c6NfOtQH+hwCBAgQIECAAAECFxMQIMd8No7C4+F5283HfOtZv/ypOYG7hMhZ3wafT4AAAQIECBDYtoAA2fP+H/1Vqwd3f4jf8y1Lfdkunu7xV7OWenucFwECBAgQIEBg3QICZI/7O/Fxx7xs9wf3t36r3D3evciX7L7F7+6rIY8u8uycFAECBAgQIE
</code></pre></div><p>你可能会想知道为什么还有<code>toObject</code>。很简单，<code>toObject</code>返回与<code>toJSON</code>相同的表示形式，只能以实际对象的形式，而不用字符串序列化。例如，以一个绿色矩形的canvas的之前的例子。</p> <p><code>canvas.toObject（）</code>的输出是这样的：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;background&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;rgba(0, 0, 0, 0)&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;objects&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;angle&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">&quot;fill&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;flipX&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;flipY&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;hasBorders&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;hasControls&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;hasRotatingPoint&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;height&quot;</span> <span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token property">&quot;left&quot;</span> <span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
      <span class="token property">&quot;opacity&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;overlayFill&quot;</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;perPixelTargetFind&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;scaleX&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;scaleY&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;selectable&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;stroke&quot;</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;strokeDashArray&quot;</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;strokeWidth&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;top&quot;</span> <span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
      <span class="token property">&quot;transparentCorners&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;rect&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;width&quot;</span> <span class="token operator">:</span> <span class="token number">20</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看出，<code>toJSON</code>输出本质上是一个字符串的<code>toObject</code>输出。现在，有趣的（有用的）事情是，toObject输出是聪明和懒惰的。您在“objects”数组中看到的内容是遍历canvas画布上所有的对象并调用该对象本身自己的<code>toObject</code>方法的结果。<code>fabric.Path</code>有自己的<code>toObject</code>，返回路径的“points”数组，
<code>fabric.Image</code>也有自己的<code>toObject</code>，返回图像的“src”属性。以真正的面向对象的方式，所有对象都能够自己序列化。</p> <p>这意味着当您创建自己的“类”，或者需要定制对象的序列化表示时，您需要做的就是使用<code>toObject</code>方法 - 完全替换它或扩展它。我们来试试一下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rect<span class="token punctuation">.</span><span class="token function-variable function">toObject</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'trololo'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rect<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出：</p> <div class="language- extra-class"><pre class="language-text"><code>'{&quot;objects&quot;:[{&quot;name&quot;:&quot;trololo&quot;}],&quot;background&quot;:&quot;rgba(0, 0, 0, 0)&quot;}'
</code></pre></div><p>您可以看到，objects数组现在有一个自定义的展示。这种覆盖可能不是很有用 - 尽管把重点提到了：我们如何拓展和更改矩形的<code>toObject</code>方法与额外的属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rect<span class="token punctuation">.</span>toObject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">toObject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fabric<span class="token punctuation">.</span>util<span class="token punctuation">.</span>object<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token function">toObject</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>toObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rect<span class="token punctuation">)</span><span class="token punctuation">;</span>

rect<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'trololo'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出：</p> <div class="language- extra-class"><pre class="language-text"><code>'{&quot;objects&quot;:[{&quot;type&quot;:&quot;rect&quot;,&quot;left&quot;:0,&quot;top&quot;:0,&quot;width&quot;:0,&quot;height&quot;:0,&quot;fill&quot;:&quot;rgb(0,0,0)&quot;,&quot;overlayFill&quot;:null,&quot;stroke&quot;:null,&quot;strokeWidth&quot;:1,&quot;strokeDashArray&quot;:null,&quot;scaleX&quot;:1,&quot;scaleY&quot;:1,&quot;angle&quot;:0,&quot;flipX&quot;:false,&quot;flipY&quot;:false,&quot;opacity&quot;:1,&quot;selectable&quot;:true,&quot;hasControls&quot;:true,&quot;hasBorders&quot;:true,&quot;hasRotatingPoint&quot;:false,&quot;transparentCorners&quot;:true,&quot;perPixelTargetFind&quot;:false,&quot;rx&quot;:0,&quot;ry&quot;:0,&quot;name&quot;:&quot;trololo&quot;}],&quot;background&quot;:&quot;rgba(0, 0, 0, 0)&quot;}'
</code></pre></div><p>我们使用附加属性“name”来扩展对象的现有<code>toObject</code>方法，所以“name”属性是<code>toObject</code>输出的一部分，值得一提的还有，如果你扩展这样的对象，您还需要确保对象所属的“class”（在这种情况下为<code>fabric.Rect</code>）在“stateProperties”数组中具有此属性，以便从字符串表示中加载canvas将解析并将其正确添加到对象中。</p> <p>您可以将对象标记为不可导出设置<code>excludeFromExport</code>为<code>true</code>。以这种方式，一些在canvas上用来辅助的对象在序列化过程中不会被保存。</p> <h3 id="tosvg"><a href="#tosvg" class="header-anchor">#</a> toSVG</h3> <p>另一种高效的基于文本的画布表示是SVG格式。由于Fabric专门从事画布上的SVG解析和渲染，所以将其作为双向过程并提供画布到SVG转换是有意义的。让我们将相同的矩形添加到画布中，并查看从toSVG方法返回的表示形式：</p> <div class="language-js extra-class"><pre class="language-js"><code>canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Rect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  left<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  width<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'green'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span><span class="token function">toSVG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出：</p> <div class="language- extra-class"><pre class="language-text"><code>'&lt;?xml version=&quot;1.0&quot; standalone=&quot;no&quot; ?&gt;&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 20010904//EN&quot; &quot;http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; version=&quot;1.1&quot; width=&quot;800&quot; height=&quot;700&quot; xml:space=&quot;preserve&quot;&gt;&lt;desc&gt;Created with Fabric.js 0.9.21&lt;/desc&gt;&lt;rect x=&quot;-10&quot; y=&quot;-10&quot; rx=&quot;0&quot; ry=&quot;0&quot; width=&quot;20&quot; height=&quot;20&quot; style=&quot;stroke: none; stroke-width: 1; stroke-dasharray: ; fill: green; opacity: 1;&quot; transform=&quot;translate(50 50)&quot; /&gt;&lt;/svg&gt;'
</code></pre></div><p>就像用<code>toJSON</code>和<code>toObject</code>一样，<code>toSVG</code>在canvas上调用时，将其逻辑委托给每个单独的对象，并且每个单独的对象都有自己的toSVG方法，它是特殊的对象类型。如果您需要修改或扩展对象的SVG表示，那么可以使用<code>toSVG</code>做同样的事情，就像我们对<code>toObject</code>一样。</p> <p>与Fabric的专有的<code>toObject / toJSON</code>相比，SVG表示的好处是可以将其投放到任何支持SVG的渲染器（浏览器，应用程序，打印机，相机等）中，并且它应该可以正常工作。但是，您首先需要将其加载到canvas画布上。谈到在画布上加载东西，现在我们可以将画布序列化成一个有效的文本块，我们将如何加载到画布上？</p> <h2 id="反序列化-svg解析器"><a href="#反序列化-svg解析器" class="header-anchor">#</a> 反序列化，SVG解析器</h2> <p>与序列化类似，有两种方式从字符串加载canvas：从JSON表示，或从SVG。当使用JSON表示时，使用<code>loadFromJSON</code>和<code>oadFromDatalessJSON</code>方法。SVG时，使用<code>fabric.loadSVGFromURL</code>和<code>fabric.loadSVGFromString</code>。</p> <p>请注意，前2个方法是实例方法，直接在canvas实例上调用，而最后2个方法是静态方法，在“fabric”对象上而不是在canvas上调用。</p> <p>这些方法没有什么可说的。他们的工作正如你所期望的那样。例如，我们先从画布中获取以前的JSON输出并将其加载到干净的画布上：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Canvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span><span class="token function">loadFromJSON</span><span class="token punctuation">(</span><span class="token string">'{&quot;objects&quot;:[{&quot;type&quot;:&quot;rect&quot;,&quot;left&quot;:50,&quot;top&quot;:50,&quot;width&quot;:20,&quot;height&quot;:20,&quot;fill&quot;:&quot;green&quot;,&quot;overlayFill&quot;:null,&quot;stroke&quot;:null,&quot;strokeWidth&quot;:1,&quot;strokeDashArray&quot;:null,&quot;scaleX&quot;:1,&quot;scaleY&quot;:1,&quot;angle&quot;:0,&quot;flipX&quot;:false,&quot;flipY&quot;:false,&quot;opacity&quot;:1,&quot;selectable&quot;:true,&quot;hasControls&quot;:true,&quot;hasBorders&quot;:true,&quot;hasRotatingPoint&quot;:false,&quot;transparentCorners&quot;:true,&quot;perPixelTargetFind&quot;:false,&quot;rx&quot;:0,&quot;ry&quot;:0},{&quot;type&quot;:&quot;circle&quot;,&quot;left&quot;:100,&quot;top&quot;:100,&quot;width&quot;:100,&quot;height&quot;:100,&quot;fill&quot;:&quot;red&quot;,&quot;overlayFill&quot;:null,&quot;stroke&quot;:null,&quot;strokeWidth&quot;:1,&quot;strokeDashArray&quot;:null,&quot;scaleX&quot;:1,&quot;scaleY&quot;:1,&quot;angle&quot;:0,&quot;flipX&quot;:false,&quot;flipY&quot;:false,&quot;opacity&quot;:1,&quot;selectable&quot;:true,&quot;hasControls&quot;:true,&quot;hasBorders&quot;:true,&quot;hasRotatingPoint&quot;:false,&quot;transparentCorners&quot;:true,&quot;perPixelTargetFind&quot;:false,&quot;radius&quot;:50}],&quot;background&quot;:&quot;rgba(0, 0, 0, 0)&quot;}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>两个物体“神奇”出现在画布上：</p> <p><img src="http://fabricjs.com/article_assets/3_5.png" alt=" "></p> <p>所以从字符串加载画布是很容易的。但是那个奇怪的<code>loadFromDatalessJSON</code>方法是干什么的？与我们刚刚使用的<code>loadFromJSON</code>有什么不同？为了理解为什么我们需要这种方法，我们需要看一下具有或多或少的复杂路径对象的序列化画布。像这个：</p> <p><img src="http://fabricjs.com/article_assets/3_6.png" alt=" "></p> <p>而这个形状的<code>JSON.stringify（canvas）</code>输出是：</p> <div class="language- extra-class"><pre class="language-text"><code>{&quot;objects&quot;:[{&quot;type&quot;:&quot;path&quot;,&quot;left&quot;:184,&quot;top&quot;:177,&quot;width&quot;:175,&quot;height&quot;:151,&quot;fill&quot;:&quot;#231F20&quot;,&quot;overlayFill&quot;:null,&quot;stroke&quot;:null,&quot;strokeWidth&quot;:1,&quot;strokeDashArray&quot;:null,&quot;scaleX&quot;:1,&quot;scaleY&quot;:1,&quot;angle&quot;:-19,&quot;flipX&quot;:false,&quot;flipY&quot;:false,&quot;opacity&quot;:1,&quot;selectable&quot;:true,&quot;hasControls&quot;:true,&quot;hasBorders&quot;:true,&quot;hasRotatingPoint&quot;:false,&quot;transparentCorners&quot;:true,&quot;perPixelTargetFind&quot;:false,&quot;path&quot;:[[&quot;M&quot;,39.502,61.823],[&quot;c&quot;,-1.235,-0.902,-3.038,-3.605,-3.038,-3.605],[&quot;s&quot;,0.702,0.4,3.907,1.203],[&quot;c&quot;,3.205,0.8,7.444,-0.668,10.114,-1.97],[&quot;c&quot;,2.671,-1.302,7.11,-1.436,9.448,-1.336],[&quot;c&quot;,2.336,0.101,4.707,0.602,4.373,2.036],[&quot;c&quot;,-0.334,1.437,-5.742,3.94,-5.742,3.94],[&quot;s&quot;,0.4,0.334,1.236,0.334],[&quot;c&quot;,0.833,0,6.075,-1.403,6.542,-4.173],[&quot;s&quot;,-1.802,-8.377,-3.272,-9.013],[&quot;c&quot;,-1.468,-0.633,-4.172,0,-4.172,0],[&quot;c&quot;,4.039,1.438,4.941,6.176,4.941,6.176],[&quot;c&quot;,-2.604,-1.504,-9.279,-1.234,-12.619,0.501],[&quot;c&quot;,-3.337,1.736,-8.379,2.67,-10.083,2.503],[&quot;c&quot;,-1.701,-0.167,-3.571,-1.036,-3.571,-1.036],[&quot;c&quot;,1.837,0.034,3.239,-2.669,3.239,-2.669],[&quot;s&quot;,-2.068,2.269,-5.542,0.434],[&quot;c&quot;,-3.47,-1.837,-1.704,-8.18,-1.704,-8.18],[&quot;s&quot;,-2.937,5.909,-1,9.816],[&quot;C&quot;,34.496,60.688,39.502,61.823,39.502,61.823],[&quot;z&quot;],[&quot;M&quot;,77.002,40.772],[&quot;c&quot;,0,0,-1.78,-5.03,-2.804,-8.546],[&quot;l&quot;,-1.557,8.411],[&quot;l&quot;,1.646,1.602],[&quot;c&quot;,0,0,0,-0.622,-0.668,-1.691],[&quot;C&quot;,72.952,39.48,76.513,40.371,77.002,40.772],[&quot;z&quot;],[&quot;M&quot;,102.989,86.943],[&quot;M&quot;,102.396,86.424],[&quot;c&quot;,0.25,0.22,0.447,0.391,0.594,0.519],[&quot;C&quot;,102.796,86.774,102.571,86.578,102.396,86.424],[&quot;z&quot;],[&quot;M&quot;,169.407,119.374],[&quot;c&quot;,-0.09,-5.429,-3.917,-3.914,-3.917,-2.402],[&quot;c&quot;,0,0,-11.396,1.603,-13.086,-6.677],[&quot;c&quot;,0,0,3.56,-5.43,1.69,-12.461],[&quot;c&quot;,-0.575,-2.163,-1.691,-5.337,-3.637,-8.605],[&quot;c&quot;,11.104,2.121,21.701,-5.08,19.038,-15.519],[&quot;c&quot;,-3.34,-13.087,-19.63,-9.481,-24.437,-9.349],[&quot;c&quot;,-4.809,0.135,-13.486,-2.002,-8.011,-11.618],[&quot;c&quot;,5.473,-9.613,18.024,-5.874,18.024,-5.874],[&quot;c&quot;,-2.136,0.668,-4.674,4.807,-4.674,4.807],[&quot;c&quot;,9.748,-6.811,22.301,4.541,22.301,4.541],[&quot;c&quot;,-3.097,-13.678,-23.153,-14.636,-30.041,-12.635],[&quot;c&quot;,-4.286,-0.377,-5.241,-3.391,-3.073,-6.637],[&quot;c&quot;,2.314,-3.473,10.503,-13.976,10.503,-13.976],[&quot;s&quot;,-2.048,2.046,-6.231,4.005],[&quot;c&quot;,-4.184,1.96,-6.321,-2.227,-4.362,-6.854],[&quot;c&quot;,1.96,-4.627,8.191,-16.559,8.191,-16.559],[&quot;c&quot;,-1.96,3.207,-24.571,31.247,-21.723,26.707],[&quot;c&quot;,2.85,-4.541,5.253,-11.93,5.253,-11.93],[&quot;c&quot;,-2.849,6.943,-22.434,25.283,-30.713,34.274],[&quot;s&quot;,-5.786,19.583,-4.005,21.987],[&quot;c&quot;,0.43,0.58,0.601,0.972,0.62,1.232],[&quot;c&quot;,-4.868,-3.052,-3.884,-13.936,-0.264,-19.66],[&quot;c&quot;,3.829,-6.053,18.427,-20.207,18.427,-20.207],[&quot;v&quot;,-1.336],[&quot;c&quot;,0,0,0.444,-1.513,-0.089,-0.444],[&quot;c&quot;,-0.535,1.068,-3.65,1.245,-3.384,-0.889],[&quot;c&quot;,0.268,-2.137,-0.356,-8.549,-0.356,-8.549],[&quot;s&quot;,-1.157,5.789,-2.758,5.61],[&quot;c&quot;,-1.603,-0.179,-2.493,-2.672,-2.405,-5.432],[&quot;c&quot;,0.089,-2.758,-1.157,-9.702,-1.157,-9.702],[&quot;c&quot;,-0.8,11.75,-8.277,8.011,-8.277,3.74],[&quot;c&quot;,0,-4.274,-4.541,-12.82,-4.541,-12.82],[&quot;s&quot;,2.403,14.421,-1.336,14.421],[&quot;c&quot;,-3.737,0,-6.944,-5.074,-9.879,-9.882],[&quot;C&quot;,78.161,5.874,68.279,0,68.279,0],[&quot;c&quot;,13.428,16.088,17.656,32.111,18.397,44.512],[&quot;c&quot;,-1.793,0.422,-2.908,2.224,-2.908,2.224],[&quot;c&quot;,0.356,-2.847,-0.624,-7.745,-1.245,-9.882],[&quot;c&quot;,-0.624,-2.137,-1.159,-9.168,-1.159,-9.168],[&quot;c&quot;,0,2.67,-0.979,5.253,-2.048,9.079],[&quot;c&quot;,-1.068,3.828,-0.801,6.054,-0.801,6.054],[&quot;c&quot;,-1.068,-2.227,-4.271,-2.137,-4.271,-2.137],[&quot;c&quot;,1.336,1.783,0.177,2.493,0.177,2.493],[&quot;s&quot;,0,0,-1.424,-1.601],[&quot;c&quot;,-1.424,-1.603,-3.473,-0.981,-3.384,0.265],[&quot;c&quot;,0.089,1.247,0,1.959,-2.849,1.959],[&quot;c&quot;,-2.846,0,-5.874,-3.47,-9.078,-3.116],[&quot;c&quot;,-3.206,0.356,-5.521,2.137,-5.698,6.678],[&quot;c&quot;,-0.179,4.541,1.869,5.251,1.869,5.251],[&quot;c&quot;,-0.801,-0.443,-0.891,-1.067,-0.891,-3.473],...
</code></pre></div><p>...这只是整个输出的其中一部分！</p> <p>这里发生了什么？事实证明，这个<code>fabric.Path</code>实例（这个形状）包括数百条贝塞尔线，决定了它是如何被渲染的。JSON表示中的所有这些<code>[“c”，0,2.67，-0.979,5.253，-2.048,9.079]</code>数据片段对应于这些曲线中的每一个。而当数百（甚至数千）的这些数据片段构成画布的表现最终是相当巨大的。</p> <p>该怎么办？
这时使用<code>toDatalessJSON</code>会方便很多。我们来试试吧：</p> <div class="language-js extra-class"><pre class="language-js"><code>canvas<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sourcePath <span class="token operator">=</span> <span class="token string">'/assets/dragon.svg'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span><span class="token function">toDatalessJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出：</p> <div class="language- extra-class"><pre class="language-text"><code>{&quot;objects&quot;:[{&quot;type&quot;:&quot;path&quot;,&quot;left&quot;:143,&quot;top&quot;:143,&quot;width&quot;:175,&quot;height&quot;:151,&quot;fill&quot;:&quot;#231F20&quot;,&quot;overlayFill&quot;:null,&quot;stroke&quot;:null,&quot;strokeWidth&quot;:1,&quot;strokeDashArray&quot;:null,&quot;scaleX&quot;:1,&quot;scaleY&quot;:1,&quot;angle&quot;:-19,&quot;flipX&quot;:false,&quot;flipY&quot;:false,&quot;opacity&quot;:1,&quot;selectable&quot;:true,&quot;hasControls&quot;:true,&quot;hasBorders&quot;:true,&quot;hasRotatingPoint&quot;:false,&quot;transparentCorners&quot;:true,&quot;perPixelTargetFind&quot;:false,&quot;path&quot;:&quot;/assets/dragon.svg&quot;}],&quot;background&quot;:&quot;rgba(0, 0, 0, 0)&quot;}
</code></pre></div><p>这样看起来小多了，发生了什么？注意在调用<code>toDatalessJSON</code>之前做了什么，我们给了“sourcePath”属性一个路径：“/assets/dragon.svg”，然后，当我们调用<code>toDatalessJSON</code>时，从前一个输出（这几百个路径命令）的整个堆积如山的路径字符串被一个单独的“dragon.svg”字符串所取代。你可以看到它显示在上面。</p> <p>当使用大量复杂的形状时，<code>toDessessJSON</code>可以让我们进一步减少画布表现，并用简单的SVG链接代替巨大的路径数据表示。</p> <p>现在回到<code>loadFromDatalessJSON</code>方法...你可以猜到，它只是允许从无数据版本的canvas表示中加载canvas。```loadFromDatalessJSON``几乎非常了解如何使用这些“路径”字符串（如“/assets/dragon.svg”），加载它们，并用作相应路径对象的数据。</p> <p>现在，我们来看看SVG加载方法。我们可以使用字符串或URL：</p> <div class="language-js extra-class"><pre class="language-js"><code>fabric<span class="token punctuation">.</span><span class="token function">loadSVGFromString</span><span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">objects<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> fabric<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">groupSVGElements</span><span class="token punctuation">(</span>objects<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">renderAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第一个参数是SVG字符串，第二个是回调函数，当SVG被解析和加载时调用回调，并且接收到2个参数 - <code>objects</code>和<code>option</code>，<code>objects</code>包含从SVG路径解析的对象数组，路径组（复杂对象），图像，文本等。为了将所有这些对象分组成一个连贯的集合，并使它们与SVG文档中的方式相同，我们使用<code>fabric.util.groupSVGElements</code>传递<code>objects</code>和<code>option</code>。在返回值中，我们可以获得<code>fabric.Path</code>或<code>fabric.Group</code>的一个实例，然后我们可以将其添加到画布上。</p> <p><code>fabric.loadSVGFromURL</code>的工作方式相同，除了将SVG内容的字符串替换为URL，还要注意，Fabric将尝试通过XMLHttpRequest获取该URL，因此SVG需要符合通常的SOP（标准操作程序）规则。</p> <h2 id="子类"><a href="#子类" class="header-anchor">#</a> 子类</h2> <p>由于Fabric以真正的面向对象的方式构建，它旨在使子类化和扩展简单自然。从这个系列的第1部分你知道，Fabric中存在对象的现有层次结构。所有2D对象（路径，图像，文本等），还有一些“classes”，都继承自<code>fabric.Object</code>，像<code>fabric.IText</code>，甚至形成3级继承。</p> <p>那么我们怎么去把Fabric中的一个现有的“class”分类呢？或者甚至创造自己的？</p> <p>对于这个任务，我们需要使用<code>fabric.util.createClass</code>实用程序。<code>createClass</code>只不过是对JavaScript的原型继承的简单抽象。我们先创建一个简单的Point“class”：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Point <span class="token operator">=</span> fabric<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">initialize</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>createClass</code>接受一个对象并使用该对象的属性创建具有实例级属性的“class”。唯一需要特别处理的属性是“initialize”用作构造函数（相当于constructor）。所以现在，当初始化Point时，我们将创建一个带有“x”和“y”属性的实例，和“toString”方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

point<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token comment">// 10</span>
point<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token comment">// 20</span>

point<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;10/20&quot;</span>

</code></pre></div><p>如果我们想创建一个“Point”类的子类“ColoredPoint”，我们将使用createClass：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ColoredPoint <span class="token operator">=</span> fabric<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span>Point<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">initialize</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callSuper</span><span class="token punctuation">(</span><span class="token string">'initialize'</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color <span class="token operator">||</span> <span class="token string">'#000'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callSuper</span><span class="token punctuation">(</span><span class="token string">'toString'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' (color: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意如何将具有实例级属性的对象作为第二个参数传递，而第一个参数接收<code>Point</code>“class”，这告诉<code>createClass</code>将其用作这个父类的“class”。为了避免重复，我们使用的是<code>callSuper</code>方法，它调用父类“class”的方法。这意味着如果我们要改变<code>Point</code>，这些更改也会传播到<code>ColoredPoint</code>。看<code>ColoredPoint</code>的行为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> redPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ColoredPoint</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token string">'#f55'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

redPoint<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token comment">// 15</span>
redPoint<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token comment">// 33</span>
redPoint<span class="token punctuation">.</span>color<span class="token punctuation">;</span> <span class="token comment">// &quot;#f55&quot;</span>

redPoint<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token string">&quot;15/35 (color: #f55)&quot;</span>
</code></pre></div><p>所以现在我们去创建我们自己的“类”和“子类”，我们来看看如何使用已经存在的Fabric。例如，我们创建一个LabeledRect“类”，它基本上是一个与它相关联的一些标签的矩形。当在画布上渲染时，该标签将被表示为矩形内的文本。类似于以前的组合示例与圆和文本。当您使用Fabric时，您会注意到，可以通过使用组合或使用自定义类来实现这样的组合抽象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> LabeledRect <span class="token operator">=</span> fabric<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span>fabric<span class="token punctuation">.</span>Rect<span class="token punctuation">,</span> <span class="token punctuation">{</span>

  type<span class="token operator">:</span> <span class="token string">'labeledRect'</span><span class="token punctuation">,</span>

  <span class="token function-variable function">initialize</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">||</span> <span class="token punctuation">(</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callSuper</span><span class="token punctuation">(</span><span class="token string">'initialize'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>label <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">toObject</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fabric<span class="token punctuation">.</span>util<span class="token punctuation">.</span>object<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callSuper</span><span class="token punctuation">(</span><span class="token string">'toObject'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      label<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">_render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callSuper</span><span class="token punctuation">(</span><span class="token string">'_render'</span><span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

    ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'20px Helvetica'</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#333'</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>label<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在这里似乎还有很多事情，但实际上很简单。</p> <p>首先，我们将父类“class”指定为<code>fabric.Rect</code>，以利用其渲染能力。接下来，我们定义“type”属性，将其设置为“labeledRect”。这只是为了一致，因为所有的Fabric对象都有类型属性（rect，circle，path，text等）。然后，我们已经熟悉的构造函数（<code>initialize</code>），我们再次使用<code>callSuper</code>。此外，我们将对象的标签设置为通过选项传递的值。最后，我们剩下两个方法：<code>toObject</code>和<code>_render</code>。 <code>toObject</code>，正如您从序列化章节已经知道的那样，负责实例的对象（和JSON）表示。由于LabeledRect具有与常规<code>Rect</code>相同的属性，也是一个标签，因此我们将扩展父类的<code>toObject</code>方法，并在其中添加标签。最后但并非最不重要的是，<code>_rendermethod</code>是实际绘制实例的原因。还有一个<code>callSuper</code>调用，它是渲染矩形，有3行文本渲染逻辑。</p> <p>现在，如果我们要渲染这样的对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> labeledRect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LabeledRect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  left<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  label<span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'#faa'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>labeledRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们会得到这个：</p> <p><img src="http://fabricjs.com/article_assets/3_7.png" alt=" "></p> <p>更改标签值或任何其他的矩形属性将按预期工作：</p> <div class="language-js extra-class"><pre class="language-js"><code>labeledRect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  label<span class="token operator">:</span> <span class="token string">'trololo'</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'#aaf'</span><span class="token punctuation">,</span>
  rx<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  ry<span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/3_8.png" alt=" "></p> <p>当然，在这一点上，你可以随意修改这个“类”的行为。例如，将某些值设置为默认值，以避免每次传递给构造函数。或者使实例上的某些可配置属性可用。如果您使其他属性可配置，则可能需要在<code>toObject</code>和<code>initialize</code>中对其进行计算。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span>
<span class="token function-variable function">initialize</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">||</span> <span class="token punctuation">(</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callSuper</span><span class="token punctuation">(</span><span class="token string">'initialize'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 给所有标注的矩形固定宽/高100/50</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>label <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
<span class="token function-variable function">_render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// 使标签的字体和填充值可配置</span>

  ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>labelFont<span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>labelFill<span class="token punctuation">;</span>

  ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>label<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><p>在这个说明中，我正在包装这个系列的第三部分，其中我们分为了Fabric的一些更先进的方面。在群组，课程和(反)序列化的帮助下，您可以将您的应用程序提升到一个全新的水平。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/6/2021, 11:19:22 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ibook/fabric/part-2.html" class="prev">
        第二部分
      </a></span> <span class="next"><a href="/ibook/fabric/part-4.html">
        第四部分
      </a>
      →
    </span></p></div> </main></div> <div class="footer" data-v-34d4abe6><div id="footer-info" data-v-34d4abe6><div class="footer-left" data-v-34d4abe6>
      © 2016-2021
      <span data-v-34d4abe6><a href="https://github.com/renquanxi/" target="_blank">清欢先生</a></span></div> <div class="footer-right" data-v-34d4abe6>Theme:<a href="https://github.com/JoeyBling/vuepress-theme-yilia-plus" target="_blank">vuepress-theme-yilia-plus</a> by Litten</div></div> <div class="busuanzi" data-v-34d4abe6><span id="busuanzi_container_site_pv" style="display:none">
    本站总访问量
    <span id="busuanzi_value_site_pv"></span>次
    <span class="post-meta-divider">|</span></span> <span id="busuanzi_container_site_uv" style="display:none">
    本站访客数
    <span id="busuanzi_value_site_uv"></span>人
  </span></div></div></main><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:185px;height:350px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="185" height="350" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:185px;height:350px;"></canvas></div><!----></div></div>
    <script src="/ibook/assets/js/app.f3dfeeca.js" defer></script><script src="/ibook/assets/js/2.a89a11ce.js" defer></script><script src="/ibook/assets/js/19.d1dc4ccb.js" defer></script>
  </body>
</html>
