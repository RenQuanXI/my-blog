<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第四部分</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/ibook/assets/css/0.styles.97c30387.css" as="style"><link rel="preload" href="/ibook/assets/js/app.f3dfeeca.js" as="script"><link rel="preload" href="/ibook/assets/js/2.a89a11ce.js" as="script"><link rel="preload" href="/ibook/assets/js/20.10200094.js" as="script"><link rel="prefetch" href="/ibook/assets/js/10.af12a82d.js"><link rel="prefetch" href="/ibook/assets/js/11.6cc43d9b.js"><link rel="prefetch" href="/ibook/assets/js/12.c1c3dc10.js"><link rel="prefetch" href="/ibook/assets/js/13.dca409ac.js"><link rel="prefetch" href="/ibook/assets/js/14.4d879880.js"><link rel="prefetch" href="/ibook/assets/js/15.85aa52f1.js"><link rel="prefetch" href="/ibook/assets/js/16.0c26d41c.js"><link rel="prefetch" href="/ibook/assets/js/17.36356e53.js"><link rel="prefetch" href="/ibook/assets/js/18.24a4eb8e.js"><link rel="prefetch" href="/ibook/assets/js/19.d1dc4ccb.js"><link rel="prefetch" href="/ibook/assets/js/21.3bb51aa7.js"><link rel="prefetch" href="/ibook/assets/js/22.c7c5a85d.js"><link rel="prefetch" href="/ibook/assets/js/23.72040ccb.js"><link rel="prefetch" href="/ibook/assets/js/24.c4b914ae.js"><link rel="prefetch" href="/ibook/assets/js/25.161a7752.js"><link rel="prefetch" href="/ibook/assets/js/26.fa65ff0a.js"><link rel="prefetch" href="/ibook/assets/js/27.37286a9b.js"><link rel="prefetch" href="/ibook/assets/js/28.7843ccc5.js"><link rel="prefetch" href="/ibook/assets/js/29.f1d9dec2.js"><link rel="prefetch" href="/ibook/assets/js/3.fb47020c.js"><link rel="prefetch" href="/ibook/assets/js/30.7cef5e20.js"><link rel="prefetch" href="/ibook/assets/js/31.876b1486.js"><link rel="prefetch" href="/ibook/assets/js/32.250a8170.js"><link rel="prefetch" href="/ibook/assets/js/33.04cc6c24.js"><link rel="prefetch" href="/ibook/assets/js/34.a11a10f8.js"><link rel="prefetch" href="/ibook/assets/js/35.40fa11c8.js"><link rel="prefetch" href="/ibook/assets/js/36.bfeb614f.js"><link rel="prefetch" href="/ibook/assets/js/37.cdd7760e.js"><link rel="prefetch" href="/ibook/assets/js/38.c7aee897.js"><link rel="prefetch" href="/ibook/assets/js/39.3b49dfa4.js"><link rel="prefetch" href="/ibook/assets/js/4.eb34ec45.js"><link rel="prefetch" href="/ibook/assets/js/40.62e8e526.js"><link rel="prefetch" href="/ibook/assets/js/41.50410ec0.js"><link rel="prefetch" href="/ibook/assets/js/42.1b86548f.js"><link rel="prefetch" href="/ibook/assets/js/43.2ae6caa2.js"><link rel="prefetch" href="/ibook/assets/js/44.75f7a0a7.js"><link rel="prefetch" href="/ibook/assets/js/5.fc1e6d38.js"><link rel="prefetch" href="/ibook/assets/js/6.1f874886.js"><link rel="prefetch" href="/ibook/assets/js/7.f700d755.js"><link rel="prefetch" href="/ibook/assets/js/8.ecde6251.js"><link rel="prefetch" href="/ibook/assets/js/9.864b0981.js">
    <link rel="stylesheet" href="/ibook/assets/css/0.styles.97c30387.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><main><main slot="sidebar-top"><a href="https://github.com/renquanxi" aria-label="View source on GitHub" target="_blank" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path> <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm" style="transform-origin: 130px 106px;"></path> <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></main> <div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ibook/" class="home-link router-link-active"><img src="/ibook/image/logo_smile.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ibook/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/studyNote/JS语法基础.html" class="nav-link">
  JS语法基础
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/JS进阶语法.html" class="nav-link">
  JS进阶语法
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/webAPI.html" class="nav-link">
  webAPI
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/jQuery常用语法.html" class="nav-link">
  jQuery常用语法
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/ES6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/Ajax 笔记整理.html" class="nav-link">
  Ajax 笔记整理
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/git学习.html" class="nav-link">
  git学习
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/常用数组方法整理.html" class="nav-link">
  常用数组方法整理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/fabric/" class="nav-link router-link-active">
  fabric中文文档
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题" class="dropdown-title"><span class="title">问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="问题" class="mobile-dropdown-title"><span class="title">问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/question/" class="nav-link">
  常见问题
</a></li><li class="dropdown-item"><!----> <a href="/ibook/createblog/" class="nav-link">
  vuepress相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><span class="title">收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="收藏" class="mobile-dropdown-title"><span class="title">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/collect/01.网站/" class="nav-link">
  网站
</a></li><li class="dropdown-item"><!----> <a href="/ibook/collect/02.资源/" class="nav-link">
  资源
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/renquanxi/ibook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  查看源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ibook/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/studyNote/JS语法基础.html" class="nav-link">
  JS语法基础
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/JS进阶语法.html" class="nav-link">
  JS进阶语法
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/webAPI.html" class="nav-link">
  webAPI
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/jQuery常用语法.html" class="nav-link">
  jQuery常用语法
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/ES6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/Ajax 笔记整理.html" class="nav-link">
  Ajax 笔记整理
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/git学习.html" class="nav-link">
  git学习
</a></li><li class="dropdown-item"><!----> <a href="/ibook/studyNote/常用数组方法整理.html" class="nav-link">
  常用数组方法整理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/fabric/" class="nav-link router-link-active">
  fabric中文文档
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题" class="dropdown-title"><span class="title">问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="问题" class="mobile-dropdown-title"><span class="title">问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/question/" class="nav-link">
  常见问题
</a></li><li class="dropdown-item"><!----> <a href="/ibook/createblog/" class="nav-link">
  vuepress相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><span class="title">收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="收藏" class="mobile-dropdown-title"><span class="title">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ibook/collect/01.网站/" class="nav-link">
  网站
</a></li><li class="dropdown-item"><!----> <a href="/ibook/collect/02.资源/" class="nav-link">
  资源
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/renquanxi/ibook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  查看源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/ibook/fabric/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/ibook/fabric/part-1.html" class="sidebar-link">第一部分</a></li><li><a href="/ibook/fabric/part-2.html" class="sidebar-link">第二部分</a></li><li><a href="/ibook/fabric/part-3.html" class="sidebar-link">第三部分</a></li><li><a href="/ibook/fabric/part-4.html" aria-current="page" class="active sidebar-link">第四部分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#自由绘画" class="sidebar-link">自由绘画</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#自定义" class="sidebar-link">自定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#锁定对象" class="sidebar-link">锁定对象</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#改变边框和角" class="sidebar-link">改变边框和角</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#禁用选择" class="sidebar-link">禁用选择</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#自定义选择" class="sidebar-link">自定义选择</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#虚线描边" class="sidebar-link">虚线描边</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#可点击区域" class="sidebar-link">可点击区域</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#旋转控件" class="sidebar-link">旋转控件</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#fabric对象变形" class="sidebar-link">Fabric对象变形</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#画布的背景和叠加" class="sidebar-link">画布的背景和叠加</a></li></ul></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#node-js上的fabric" class="sidebar-link">Node.js上的Fabric</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#node服务器与fabric" class="sidebar-link">Node服务器与Fabric</a></li><li class="sidebar-sub-header"><a href="/ibook/fabric/part-4.html#在node环境自定义fabric的字体" class="sidebar-link">在Node环境自定义Fabric的字体</a></li></ul></li></ul></li><li><a href="/ibook/fabric/part-5.html" class="sidebar-link">第五部分</a></li><li><a href="/ibook/fabric/part-6.html" class="sidebar-link">第六部分</a></li><li><a href="/ibook/fabric/part-7.html" class="sidebar-link">第七部分</a></li><li><a href="/ibook/fabric/part-8.html" class="sidebar-link">第八部分</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第四部分"><a href="#第四部分" class="header-anchor">#</a> 第四部分</h1> <p>我们已经在前几个系列涵盖了很多话题，从基础对象操作到动画，事件，滤镜，组合和子类。但还有几件非常有趣和有用的事情要讨论！</p> <h2 id="自由绘画"><a href="#自由绘画" class="header-anchor">#</a> 自由绘画</h2> <p>如果说有什么功能能让<code>&lt;canvas&gt;</code>在眼前一亮，那一定是它能够很好的支持自由绘图！由于画布只是一个2D位图， Fabric为我们提供了一张纸：可以自由绘画，而且非常自然。</p> <p>只需将Fabric canvas的<code>isDrawingMode</code>属性设置为<code>true</code>即可实现自由绘制模式。这样画布上的点击和移动就会被立刻解释为铅笔或刷子。</p> <p>当<code>isDrawingMode</code>为<code>true</code>时，您可以随意在画布上多次绘制，但是一旦你在画布上做任何动作，然后触发“mouseup”事件，Fabric就会触发&quot;path:created&quot; 事件，并且将刚刚的绘画转变为<code>fabric.Path</code>的实例，</p> <p>如果在任何时刻，将<code>isDrawingMode</code>设置为<code>false</code>，你创建的路径对象会仍然存在于画布上。而且由于它们是<code>fabric.Path</code>对象，所以可以以任何方式修改它们： 移动，旋转，缩放等。</p> <p>还有两个属性可以定制自由绘图： <code>freeDrawingBrush.color</code> and <code>freeDrawingBrush.width</code>，两者都可以通过<code>freeDrawingBrush</code>实例在Fabric画布实例上使用。<code>freeDrawingBrush.color</code>可以是任何常规的颜色值，代表画笔的颜色。<code>freeDrawingBrush.width</code>是一个像素，代表画笔的宽度。</p> <p><img src="http://fabricjs.com/article_assets/4_1.png" alt=" "></p> <p>在不久的将来，我们计划添加更多的自由绘图选项：各种版本的画笔（如喷雾式或粉笔式）。还可以自定义画笔模式，还有一个可以自己扩展的选项，类似于Fabric图像滤镜。</p> <h2 id="自定义"><a href="#自定义" class="header-anchor">#</a> 自定义</h2> <p>一件有趣的事情是如何去自定义Fabric，您可以在<code>canvas</code>或<code>canvas</code>对象上调整数十种各样的参数，以使事情按照所需的方式运行。我们来看看其中的一些。</p> <h3 id="锁定对象"><a href="#锁定对象" class="header-anchor">#</a> 锁定对象</h3> <p>画布上的每个对象都可以以几种方式锁定。“lockMovementX”，“lockMovementY”，“lockRotation”，“lockScalingX”，“lockScalingY”是锁定相应对象动作的属性。所以将某个对象的<code>lockMovementX</code>属性设置为<code>true</code>会阻止对象被水平移动，此时你仍然可以垂直移动它。类似的，<code>lockRotation</code>可以阻止旋转，<code>lockScalingX</code> / <code>lockScalingY</code> 可以阻止水平或者垂直缩放。所有这些都是可以叠加的，你可以将它们组合在一起使用。</p> <h3 id="改变边框和角"><a href="#改变边框和角" class="header-anchor">#</a> 改变边框和角</h3> <p>您可以通过“hasControls”和“hasBorders”属性来控制对象的边框和角的可见性。只是将它们设置为<code>false</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code>object<span class="token punctuation">.</span>hasBorders <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/4_2.png" alt=" "></p> <div class="language-js extra-class"><pre class="language-js"><code>object<span class="token punctuation">.</span>hasControls <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/4_3.png" alt=" "></p> <p>您还可以通过某些自定义属性来调整它的外观：“cornerDashArray”，“borderDashArray”，“borderColor”，“transparentCorners”“cornerColor”，“cornerStrokeColor”，“cornerStyle”，“selectionBackgroundColor”，“padding”和“cornerSize”。</p> <div class="language-js extra-class"><pre class="language-js"><code>object<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  borderColor<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
  cornerColor<span class="token operator">:</span> <span class="token string">'green'</span><span class="token punctuation">,</span>
  cornerSize<span class="token operator">:</span> <span class="token number">6</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/4_4.png" alt=" "></p> <div class="language-js extra-class"><pre class="language-js"><code>  object<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    transparentCorners<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    cornerColor<span class="token operator">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span>
    cornerStrokeColor<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
    borderColor<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
    cornerSize<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    padding<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    cornerStyle<span class="token operator">:</span> <span class="token string">'circle'</span><span class="token punctuation">,</span>
    borderDashArray<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
</code></pre></div><p><img src="http://fabricjs.com/article_assets/4_4b.png" alt=" "></p> <h3 id="禁用选择"><a href="#禁用选择" class="header-anchor">#</a> 禁用选择</h3> <p>您可以通过将canvas的“selection”属性设置为<code>false</code>来禁用画布上的对象选择，这可以防止在画布上选中任何对象。如果只需要使某些对象不可选，则可以更改某个对象的“selectable”属性，只是将其设置为<code>false</code>，并且对象失去其交互性。</p> <h3 id="自定义选择"><a href="#自定义选择" class="header-anchor">#</a> 自定义选择</h3> <p>现在，如果你不想禁用选择，而是要改变它的外观呢？没问题。</p> <p>canvas画布上有4个属性来控制它的表现： &quot;selectionColor&quot;, &quot;selectionBorderColor&quot;, &quot;selectionLikeWidth&quot;, and &quot;selectionDashArray&quot;。这些都非常的语义化，让我们来看一个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code>canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> radius<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> fill<span class="token operator">:</span> <span class="token string">'#f55'</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> left<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span>selectionColor <span class="token operator">=</span> <span class="token string">'rgba(0,255,0,0.3)'</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>selectionBorderColor <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>selectionLineWidth <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/4_8.png" alt=" "></p> <p>最后一个属性“selectionDashArray”可不是那么简单，他允许我们使用虚线作为选择线。定义虚线模式的方式是通过数组指定间隔。因此，要创建一个模式，其中有一个大点的数字，后面跟着一个小一点的数字来代表虚线的间隔，我们可以使用<code>[10，5]</code>，作为“selectionDashArray”。这将画出10px长的线，然后跳过5px，再画一个10px长度的线，以此类推。如果我们使用<code>[2, 4, 6]</code>的数组，这样将通过绘制2px长的线，然后跳过4px，然后绘制6px线，然后跳过2px，然后绘制4px线，然后跳过6px，以此类推。例如，这就是<code>[5,10]</code>规则的样子：</p> <p><img src="http://fabricjs.com/article_assets/4_9.png" alt=" "></p> <h3 id="虚线描边"><a href="#虚线描边" class="header-anchor">#</a> 虚线描边</h3> <p>与canvas上的“selectionDashArray”类似，所有Fabric对象都有“strokeDashArray”属性，负责在对象上执行虚线的描边操作。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Rect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  fill<span class="token operator">:</span> <span class="token string">'#06538e'</span><span class="token punctuation">,</span>
  width<span class="token operator">:</span> <span class="token number">125</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">125</span><span class="token punctuation">,</span>
  stroke<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
  strokeDashArray<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rect<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/4_13.png" alt=" "></p> <h3 id="可点击区域"><a href="#可点击区域" class="header-anchor">#</a> 可点击区域</h3> <p>如你所知，所有的Fabric对象都有边界边框，用于拖动、旋转、缩放。您可能已经注意到，当用于控制的角和边框存在时，即使在单击没有绘制内容的对象边框内的空白时也可以拖动该对象。</p> <p>看看这个图像：</p> <p><img src="http://fabricjs.com/article_assets/4_14.png" alt=" "></p> <p>默认情况下，画布上的所有Fabric对象都可以通过边框拖动。如果你想要不同的行为，例如根据Fabric对象的实际内容进行点击或拖拽，您可以在对象上使用“perPixelTargetFind”属性。只需将其设置为<code>true</code>即可获得所需的行为。</p> <h3 id="旋转控件"><a href="#旋转控件" class="header-anchor">#</a> 旋转控件</h3> <p>由于版本1.0 Fabric在默认情况下使用默认UI，对象不能同时缩放和旋转。作为代替的是每个对象都有一个单独的旋转控件。该控件的相应属性为“hasRotatingPoint”，默认是<code>true</code>，将其设置为<code>false</code>可以禁用旋转控制。您也可以通过“rotatePointOffset”数字属性自定义其相对于对象的偏移量。</p> <p><img src="http://fabricjs.com/article_assets/4_10.png" alt=" "></p> <h3 id="fabric对象变形"><a href="#fabric对象变形" class="header-anchor">#</a> Fabric对象变形</h3> <p>自<strong>1.0</strong>版以来，Fabric中还提供了许多其他与转换相关的属性，其中一个是画布实例上的“uniScaleTransform”。默认为<code>false</code>，可用于启用对象的非均匀缩放;换句话说，它允许在通过角拖动时改变对象的比例。</p> <p><img src="http://fabricjs.com/article_assets/4_15.png" alt=" "></p> <p>有“centeredScaling”和“centeredRotation”属性（在v1.3.4之前是一个属性“centerTransform”）。他们指定对象的中心是否应该用作转换的起点。当它们都设置为<code>true</code>，对象总是从中心缩放/旋转时，它会和<strong>1.0</strong>之前的行为相同。由于<strong>1.0</strong>变形原点是动态的，这样可以在缩放对象时进行更精细的控制。</p> <p>最后一对新属性是“originX”和“originY”。默认设置为“left”和“top”，它们允许以编程的方式更改变形的原点。当你拖动对象的角时，就是这些属性正在动态变化。</p> <p>那么什么时候需要我们手动更改它们？举个例子，当我们处理文本对象时，当您动态的改变文本并且文本框尺寸变大，“originX”和“originY”指出了增长的位置。所以如果你需要文本对象居中时，你可以将originX设置为“center”。如果让文本移到右边，你需要将“originX”设置为“right”等等。这种行为类似于CSS中的“position：absolute”。</p> <h3 id="画布的背景和叠加"><a href="#画布的背景和叠加" class="header-anchor">#</a> 画布的背景和叠加</h3> <p>从第一部分可以记得，您可以指定一个颜色来填充整个画布背景。只需将任意常规颜色值设置为canvas的“backgroundColor”属性。</p> <div class="language-js extra-class"><pre class="language-js"><code>canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> radius<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> fill<span class="token operator">:</span> <span class="token string">'#f55'</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> left<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">'rgba(0,0,255,0.3)'</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">renderAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/4_5.png" alt=" "></p> <p>你可以进一步去分配图像作为背景。您需要使用<code>setBackgroundImage</code>方法，传递url和一个可选的完成回调。</p> <div class="language-js extra-class"><pre class="language-js"><code>canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> radius<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> fill<span class="token operator">:</span> <span class="token string">'#f55'</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> left<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">setBackgroundImage</span><span class="token punctuation">(</span><span class="token string">'../assets/pug.jpg'</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token function">renderAll</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/4_6.png" alt=" "></p> <p>最后，您还可以设置叠加图像，在这种情况下，它将始终显示在画布上呈现的任何对象之上。只需使用setOverlayImage，传递url和一个可选的完成回调。</p> <div class="language-js extra-class"><pre class="language-js"><code>canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> radius<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> fill<span class="token operator">:</span> <span class="token string">'#f55'</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> left<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">setOverlayImage</span><span class="token punctuation">(</span><span class="token string">'../assets/jail_cell_bars.png'</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token function">renderAll</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://fabricjs.com/article_assets/4_7.png" alt=" "></p> <h2 id="node-js上的fabric"><a href="#node-js上的fabric" class="header-anchor">#</a> Node.js上的Fabric</h2> <p>Fabric的独特之处在于它不仅可以在客户端，浏览器中也可以在服务器上工作！当您要从客户端发送数据并在服务器上直接创建该数据的映像时，这可能很有用。或者如果您为了速度，方便性或其他原因，只是想从控制台使用Fabric API。</p> <p>让我们来看看如何设置在Node环境下运行Fabric。</p> <p>首先，您需要安装<a href="http://nodejs.org/" target="_blank" rel="noopener noreferrer">Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，如果还没有。有几种方法来安装Node，具体取决于你的操作系统。您可以按照<a href="http://howtonode.org/how-to-install-nodejs" target="_blank" rel="noopener noreferrer">这些说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或<a href="https://github.com/joyent/node/wiki/Installation" target="_blank" rel="noopener noreferrer">这些说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>Node安装成功之后，我们需要安装<a href="https://github.com/LearnBoost/node-canvas" target="_blank" rel="noopener noreferrer">node-canvas<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>库，node-canvas是NodeJS的Canvas实现。它依赖<a href="http://cairographics.org/" target="_blank" rel="noopener noreferrer">Cairo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>- 可以在Mac，Linux或Windows上运行的2D图形库。node-canvas具有专门的<a href="https://github.com/LearnBoost/node-canvas/wiki" target="_blank" rel="noopener noreferrer">安装说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，具体取决于您的操作系统。</p> <p>由于Fabric运行在Node上，它作为一个NPM包。所以下一步是安装NPM。您可以在其<a href="https://github.com/isaacs/npm" target="_blank" rel="noopener noreferrer">github repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中找到安装说明，不过一般情况下当您安装Node的时候会自动安装了NPM。</p> <p>最后一步是安装<a href="https://npmjs.org/package/fabric" target="_blank" rel="noopener noreferrer">Fabric<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>包，使用NPM。这通过运行<code>npm install fabric</code>（或<code>npm install -g fabric</code>来全局安装包）完成。</p> <p>我们现在运行Node控制台，应该就使用node-canvas和Fabric了：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> node
<span class="token punctuation">..</span>.
<span class="token operator">&gt;</span> typeof require<span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token string">&quot;function&quot;</span>
<span class="token operator">&gt;</span> typeof require<span class="token punctuation">(</span><span class="token string">'fabric'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token string">&quot;object&quot;</span>
</code></pre></div><p>现在一切都准备好了，我们可以尝试一个简单的“helloworld”的测试。让我们创建一个helloworld.js文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fabric <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fabric'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fabric<span class="token punctuation">,</span>
    out <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/helloworld.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> canvas <span class="token operator">=</span> fabric<span class="token punctuation">.</span><span class="token function">createCanvasForNode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  left<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  fill<span class="token operator">:</span> <span class="token string">'#f55'</span><span class="token punctuation">,</span>
  angle<span class="token operator">:</span> <span class="token number">15</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> stream <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">createPNGStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后运行它作为<code>node helloworld.js</code>，打开helloworld.png：</p> <p><img src="http://fabricjs.com/article_assets/4_11.png" alt=" "></p> <p>那么这里发生了什么？我们来看看这段代码的重要部分。</p> <p>首先，我们引入了Fabric<code>fabric = require('fabric').fabric</code>，然后我们用<code>fabric.createCanvasForNode()</code>替代了平时使用的<code>new fabric.Canvas()</code>来创建了Fabric的canvas画布，此方法将width和height作为参数，并创建该大小的画布（在这种不传参的情况下为200x200）。</p> <p>然后有熟悉的对象创建（<code>new fabric.Text（）</code>）和添加到画布（<code>canvas.add（text）</code>）。</p> <p>到目前做的一切都只是创建了一个Fabric画布，然后渲染了一个text文本，现在，如何创建在画布上呈现的任何图像？在canvas实例上使用可用的<code>createPNGStream</code>方法。<code>createPNGStream</code>返回Node的<a href="http://nodejs.org/api/stream.html" target="_blank" rel="noopener noreferrer">流<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，然后可以使用<code>on（'data'）</code>输出到图像文件中，并将其写入与图像文件（<code>fs.createWriteStream（）</code>）对应的流中。</p> <p><code>fabric.createCanvasForNode</code>和<code>canvas.createPNGStream</code>几乎是Node特有的唯一2种方法，其他一切都是一样的。您仍然可以按照通常的方式创建对象，将它们添加到画布上，修改，渲染等。值得一提的是，当您通过<code>createCanvasForNode</code>创建画布时，它将使用<code>nodeCanvas</code>属性进行扩展，该属性是对原始节点画布实例的引用。</p> <h3 id="node服务器与fabric"><a href="#node服务器与fabric" class="header-anchor">#</a> Node服务器与Fabric</h3> <p>例如，让我们创建一个简单的Node服务器，它将使用JSON格式的Fabric数据收听传入的请求，并输出该数据的图像。整个脚本只有25行长！</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fabric <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fabric'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fabric<span class="token punctuation">,</span>
    http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">8124</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> fabric<span class="token punctuation">.</span><span class="token function">createCanvasForNode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'image/png'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  canvas<span class="token punctuation">.</span><span class="token function">loadFromJSON</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>query<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    canvas<span class="token punctuation">.</span><span class="token function">renderAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> stream <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">createPNGStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>此片段中的大部分代码应该已经很熟悉了。它的要点在于服务器响应。我们正在创建Fabric画布，将JSON数据加载到其中，渲染它，并将最终结果作为服务器响应进行流式传输。</p> <p>要测试它，我们来获取一个绿色，并且稍微旋转的矩形：</p> <div class="language- extra-class"><pre class="language-text"><code>{&quot;objects&quot;:[{&quot;type&quot;:&quot;rect&quot;,&quot;left&quot;:103.85,&quot;top&quot;:98.85,&quot;width&quot;:50,&quot;height&quot;:50,&quot;fill&quot;:&quot;#9ae759&quot;,&quot;overlayFill&quot;:null,&quot;stroke&quot;:null,&quot;strokeWidth&quot;:1,&quot;strokeDashArray&quot;:null,&quot;scaleX&quot;:1.39,&quot;scaleY&quot;:1.39,&quot;angle&quot;:30,&quot;flipX&quot;:false,&quot;flipY&quot;:false,&quot;opacity&quot;:0.8,&quot;selectable&quot;:true,&quot;hasControls&quot;:true,&quot;hasBorders&quot;:true,&quot;hasRotatingPoint&quot;:false,&quot;transparentCorners&quot;:true,&quot;perPixelTargetFind&quot;:false,&quot;rx&quot;:0,&quot;ry&quot;:0}],&quot;background&quot;:&quot;rgba(0, 0, 0, 0)&quot;}
</code></pre></div><p>URL编码后：</p> <div class="language- extra-class"><pre class="language-text"><code>%7B&quot;objects&quot;%3A%5B%7B&quot;type&quot;%3A&quot;rect&quot;%2C&quot;left&quot;%3A103.85%2C&quot;top&quot;%3A98.85%2C&quot;width&quot;%3A50%2C&quot;height&quot;%3A50%2C&quot;fill&quot;%3A&quot;%239ae759&quot;%2C&quot;overlayFill&quot;%3Anull%2C&quot;stroke&quot;%3Anull%2C&quot;strokeWidth&quot;%3A1%2C&quot;strokeDashArray&quot;%3Anull%2C&quot;scaleX&quot;%3A1.39%2C&quot;scaleY&quot;%3A1.39%2C&quot;angle&quot;%3A30%2C&quot;flipX&quot;%3Afalse%2C&quot;flipY&quot;%3Afalse%2C&quot;opacity&quot;%3A0.8%2C&quot;selectable&quot;%3Atrue%2C&quot;hasControls&quot;%3Atrue%2C&quot;hasBorders&quot;%3Atrue%2C&quot;hasRotatingPoint&quot;%3Afalse%2C&quot;transparentCorners&quot;%3Atrue%2C&quot;perPixelTargetFind&quot;%3Afalse%2C&quot;rx&quot;%3A0%2C&quot;ry&quot;%3A0%7D%5D%2C&quot;background&quot;%3A&quot;rgba(0%2C%200%2C%200%2C%200)&quot;%7D
</code></pre></div><p>并通过“data”查询参数传递给服务器。立即回应“image / png”的Content-type，如下所示：</p> <p>正如你所看到的，在服务器上使用Fabric是非常简单直接的。随意试验这个片段。可以从URL参数中更改画布尺寸，或者在返回图像作为响应之前修改客户端数据。</p> <h3 id="在node环境自定义fabric的字体"><a href="#在node环境自定义fabric的字体" class="header-anchor">#</a> 在Node环境自定义Fabric的字体</h3> <p>在我们可以在Fabric中使用自定义字体之前，我们需要先加载它们。在浏览器（客户端）中，加载字体的最常用方法是使用<a href="http://www.w3.org/TR/css3-fonts/#font-face-rule" target="_blank" rel="noopener noreferrer">CSS3 @font-face<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>规则。 在Node（服务器端）的Fabric中，我们可以使用node-canvas的<strong>Font API</strong>加载字体。</p> <p>下面的示例演示如何加载和使用自定义字体。将其保存到customfont.js并确保字体文件的路径正确。在这个例子中，我们使用<a href="http://www.google.com/fonts/specimen/Ubuntu" target="_blank" rel="noopener noreferrer">Ubuntu<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>作为自定义字体。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fabric <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fabric'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fabric<span class="token punctuation">,</span>
    canvas <span class="token operator">=</span> fabric<span class="token punctuation">.</span><span class="token function">createCanvasForNode</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> font <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">canvas<span class="token punctuation">.</span>Font</span><span class="token punctuation">(</span><span class="token string">'Ubuntu'</span><span class="token punctuation">,</span> __dirname <span class="token operator">+</span> <span class="token string">'/fonts/Ubuntu-Regular.ttf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
font<span class="token punctuation">.</span><span class="token function">addFace</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/fonts/Ubuntu-Bold.ttf'</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
font<span class="token punctuation">.</span><span class="token function">addFace</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/fonts/Ubuntu-Italic.ttf'</span><span class="token punctuation">,</span> <span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token string">'italic'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
font<span class="token punctuation">.</span><span class="token function">addFace</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/fonts/Ubuntu-BoldItalic.ttf'</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">,</span> <span class="token string">'italic'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span>contextContainer<span class="token punctuation">.</span><span class="token function">addFont</span><span class="token punctuation">(</span>font<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 使用 createPNGStream 或者 createJPEGStream 的时候</span>
canvas<span class="token punctuation">.</span>contextTop<span class="token punctuation">.</span><span class="token function">addFont</span><span class="token punctuation">(</span>font<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 使用 toDataURL 或者 toDataURLWithMultiplier的时候</span>

<span class="token keyword">var</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token string">'regular'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    left<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>
    top<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
    fontFamily<span class="token operator">:</span> <span class="token string">'Ubuntu'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token string">'bold'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    left<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>
    top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    fontFamily<span class="token operator">:</span> <span class="token string">'Ubuntu'</span><span class="token punctuation">,</span>
    fontWeight<span class="token operator">:</span> <span class="token string">'bold'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token string">'italic'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    left<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>
    top<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>
    fontFamily<span class="token operator">:</span> <span class="token string">'Ubuntu'</span><span class="token punctuation">,</span>
    fontStyle<span class="token operator">:</span> <span class="token string">'italic'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span><span class="token string">'bold italic'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    left<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>
    top<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    fontFamily<span class="token operator">:</span> <span class="token string">'Ubuntu'</span><span class="token punctuation">,</span>
    fontWeight<span class="token operator">:</span> <span class="token string">'bold'</span><span class="token punctuation">,</span>
    fontStyle<span class="token operator">:</span> <span class="token string">'italic'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> out <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/customfont.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> stream <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">createPNGStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行<code>node customfont.js</code>创建一个图像（customfont.png），如下所示：</p> <p><img src="http://fabricjs.com/article_assets/4_16.png" alt=" "></p> <p>让我们仔细看看发生了什么。首先，通过将字体名称和路径（作为常规字体文件）作为参数传递，创建一个字体对象<code>new canvas.Font（）</code>。然后通过将字体path，weight和style作为参数传递，使用<code>font.addFace（）</code>添加其他字体。最后，使用<code>canvas.contextContainer.addFont（）</code>（当使用<strong>createPNGStream</strong>或<strong>createJPEGStream</strong>时）或<code>canvas.contextTop.addFont（）</code>（使用<strong>toDataURL</strong>或<strong>toDataURLWithMultiplier</strong>时）可以将字体添加到所需的上下文中。</p> <p>现在我们可以通过将<code>fabric.Text</code>对象的<strong>fontFamily</strong>属性设置为字体名称来使用我们的字体。结合<strong>fontWeight</strong>和<strong>fontStyle</strong>属性，我们可以应用我们添加的字体。有关这些属性的更多信息，请参阅第2部分。请注意，该示例显示了如何在创建新文本对象时使用自定义字体，但这也适用于通过JSON加载的文本对象。</p> <p>这就到了Fabric的4部分系列的结尾。我希望你现在拥有足够的知识，创造有趣，酷，有用，有趣，具有挑战性，令人兴奋的东西！</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/6/2021, 11:19:22 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ibook/fabric/part-3.html" class="prev">
        第三部分
      </a></span> <span class="next"><a href="/ibook/fabric/part-5.html">
        第五部分
      </a>
      →
    </span></p></div> </main></div> <div class="footer" data-v-34d4abe6><div id="footer-info" data-v-34d4abe6><div class="footer-left" data-v-34d4abe6>
      © 2016-2021
      <span data-v-34d4abe6><a href="https://github.com/renquanxi/" target="_blank">清欢先生</a></span></div> <div class="footer-right" data-v-34d4abe6>Theme:<a href="https://github.com/JoeyBling/vuepress-theme-yilia-plus" target="_blank">vuepress-theme-yilia-plus</a> by Litten</div></div> <div class="busuanzi" data-v-34d4abe6><span id="busuanzi_container_site_pv" style="display:none">
    本站总访问量
    <span id="busuanzi_value_site_pv"></span>次
    <span class="post-meta-divider">|</span></span> <span id="busuanzi_container_site_uv" style="display:none">
    本站访客数
    <span id="busuanzi_value_site_uv"></span>人
  </span></div></div></main><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:185px;height:350px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="185" height="350" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:185px;height:350px;"></canvas></div><!----></div></div>
    <script src="/ibook/assets/js/app.f3dfeeca.js" defer></script><script src="/ibook/assets/js/2.a89a11ce.js" defer></script><script src="/ibook/assets/js/20.10200094.js" defer></script>
  </body>
</html>
